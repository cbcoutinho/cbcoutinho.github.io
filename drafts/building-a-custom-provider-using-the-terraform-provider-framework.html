<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>Building a custom provider using the Terraform Provider Framework</title>
        <link rel="stylesheet" href="https://blog.coutinho.io/theme/css/main.css" />
        <link href="https://blog.coutinho.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Chris' blog Atom Feed" />
        <meta name="description" content="package provider import ( "context" "os" "github.com/hashicorp/terraform-plugin-framework/datasource"..." />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="https://blog.coutinho.io/">Chris' blog</a></h1>
                <nav><ul>
                    <li><a href="https://blog.coutinho.io/pages/about.html">About</a></li>
                    <li><a href="https://blog.coutinho.io/pages/contact.html">Contact</a></li>
                    <li class="active"><a href="https://blog.coutinho.io/category/notes.html">Notes</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="https://blog.coutinho.io/drafts/building-a-custom-provider-using-the-terraform-provider-framework.html" rel="bookmark"
           title="Permalink to Building a custom provider using the Terraform Provider Framework">Building a custom provider using the Terraform Provider Framework</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2023-07-11T00:00:00+02:00">
                Published: Tue 11 July 2023
        </abbr>
		<br />
        <abbr class="modified" title="2023-07-12T17:49:10.602237+02:00">
                Updated: Wed 12 July 2023
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="https://blog.coutinho.io/author/chris-coutinho.html">Chris Coutinho</a>
        </address>
<p>In <a href="https://blog.coutinho.io/category/notes.html">Notes</a>.</p>

</footer><!-- /.post-info -->      <div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">provider</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;context&quot;</span>
<span class="w">    </span><span class="s">&quot;os&quot;</span>

<span class="w">    </span><span class="s">&quot;github.com/hashicorp/terraform-plugin-framework/datasource&quot;</span>
<span class="w">    </span><span class="s">&quot;github.com/hashicorp/terraform-plugin-framework/path&quot;</span>
<span class="w">    </span><span class="s">&quot;github.com/hashicorp/terraform-plugin-framework/provider&quot;</span>
<span class="w">    </span><span class="s">&quot;github.com/hashicorp/terraform-plugin-framework/provider/schema&quot;</span>
<span class="w">    </span><span class="s">&quot;github.com/hashicorp/terraform-plugin-framework/resource&quot;</span>
<span class="w">    </span><span class="s">&quot;github.com/hashicorp/terraform-plugin-framework/types&quot;</span>
<span class="w">    </span><span class="s">&quot;github.com/hashicorp/terraform-plugin-log/tflog&quot;</span>
<span class="p">)</span>

<span class="c1">// Ensure the implementation satisfies the expected interfaces.</span>
<span class="kd">var</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="nx">_</span><span class="w"> </span><span class="nx">provider</span><span class="p">.</span><span class="nx">Provider</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">longshipProvider</span><span class="p">{}</span>
<span class="p">)</span>

<span class="c1">// New is a helper function to simplify provider server and testing implementation.</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">New</span><span class="p">(</span><span class="nx">version</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="nx">provider</span><span class="p">.</span><span class="nx">Provider</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="nx">provider</span><span class="p">.</span><span class="nx">Provider</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">longshipProvider</span><span class="p">{</span>
<span class="w">            </span><span class="nx">version</span><span class="p">:</span><span class="w"> </span><span class="nx">version</span><span class="p">,</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// longshipProvider is the provider implementation.</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">longshipProvider</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// version is set to the provider version on release, &quot;dev&quot; when the</span>
<span class="w">    </span><span class="c1">// provider is built and ran locally, and &quot;test&quot; when running acceptance</span>
<span class="w">    </span><span class="c1">// testing.</span>
<span class="w">    </span><span class="nx">version</span><span class="w"> </span><span class="kt">string</span>
<span class="p">}</span>

<span class="c1">// Metadata returns the provider type name.</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="o">*</span><span class="nx">longshipProvider</span><span class="p">)</span><span class="w"> </span><span class="nx">Metadata</span><span class="p">(</span><span class="nx">_</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="nx">provider</span><span class="p">.</span><span class="nx">MetadataRequest</span><span class="p">,</span><span class="w"> </span><span class="nx">resp</span><span class="w"> </span><span class="o">*</span><span class="nx">provider</span><span class="p">.</span><span class="nx">MetadataResponse</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">resp</span><span class="p">.</span><span class="nx">TypeName</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;longship&quot;</span>
<span class="w">    </span><span class="nx">resp</span><span class="p">.</span><span class="nx">Version</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">version</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">longshipProviderModel</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Host</span><span class="w">           </span><span class="nx">types</span><span class="p">.</span><span class="nx">String</span><span class="w"> </span><span class="s">`tfsdk:&quot;host&quot;`</span>
<span class="w">    </span><span class="nx">TenantKey</span><span class="w">      </span><span class="nx">types</span><span class="p">.</span><span class="nx">String</span><span class="w"> </span><span class="s">`tfsdk:&quot;tenant_key&quot;`</span>
<span class="w">    </span><span class="nx">ApplicationKey</span><span class="w"> </span><span class="nx">types</span><span class="p">.</span><span class="nx">String</span><span class="w"> </span><span class="s">`tfsdk:&quot;application_key&quot;`</span>
<span class="p">}</span>

<span class="c1">// Schema defines the provider-level schema for configuration data.</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="o">*</span><span class="nx">longshipProvider</span><span class="p">)</span><span class="w"> </span><span class="nx">Schema</span><span class="p">(</span><span class="nx">_</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="nx">provider</span><span class="p">.</span><span class="nx">SchemaRequest</span><span class="p">,</span><span class="w"> </span><span class="nx">resp</span><span class="w"> </span><span class="o">*</span><span class="nx">provider</span><span class="p">.</span><span class="nx">SchemaResponse</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">resp</span><span class="p">.</span><span class="nx">Schema</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">schema</span><span class="p">.</span><span class="nx">Schema</span><span class="p">{</span>
<span class="w">        </span><span class="nx">Attributes</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">schema</span><span class="p">.</span><span class="nx">Attribute</span><span class="p">{</span>
<span class="w">            </span><span class="s">&quot;host&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">schema</span><span class="p">.</span><span class="nx">StringAttribute</span><span class="p">{</span>
<span class="w">                </span><span class="nx">Description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;URI for Longship API. May also be provided via LONGSHIP_HOST environment variable.&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">Optional</span><span class="p">:</span><span class="w">    </span><span class="kc">true</span><span class="p">,</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="s">&quot;tenant_key&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">schema</span><span class="p">.</span><span class="nx">StringAttribute</span><span class="p">{</span>
<span class="w">                </span><span class="nx">Description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Tenant key for Longship API. May also be provided via LONGSHIP_TENANT_KEY environment variable.&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">Optional</span><span class="p">:</span><span class="w">    </span><span class="kc">true</span><span class="p">,</span>
<span class="w">                </span><span class="nx">Sensitive</span><span class="p">:</span><span class="w">   </span><span class="kc">true</span><span class="p">,</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="s">&quot;application_key&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">schema</span><span class="p">.</span><span class="nx">StringAttribute</span><span class="p">{</span>
<span class="w">                </span><span class="nx">Description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Application key for Longship API. May also be provided via LONGSHIP_APPLICATION_KEY environment variable.&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">Optional</span><span class="p">:</span><span class="w">    </span><span class="kc">true</span><span class="p">,</span>
<span class="w">                </span><span class="nx">Sensitive</span><span class="p">:</span><span class="w">   </span><span class="kc">true</span><span class="p">,</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Configure prepares a Longship API client for data sources and resources.</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="o">*</span><span class="nx">longshipProvider</span><span class="p">)</span><span class="w"> </span><span class="nx">Configure</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">req</span><span class="w"> </span><span class="nx">provider</span><span class="p">.</span><span class="nx">ConfigureRequest</span><span class="p">,</span><span class="w"> </span><span class="nx">resp</span><span class="w"> </span><span class="o">*</span><span class="nx">provider</span><span class="p">.</span><span class="nx">ConfigureResponse</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nx">tflog</span><span class="p">.</span><span class="nx">Debug</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Configuring Longship client&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// Retrieve provider data from configuration</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">config</span><span class="w"> </span><span class="nx">longshipProviderModel</span>
<span class="w">    </span><span class="nx">diags</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">Config</span><span class="p">.</span><span class="nx">Get</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">config</span><span class="p">)</span>
<span class="w">    </span><span class="nx">resp</span><span class="p">.</span><span class="nx">Diagnostics</span><span class="p">.</span><span class="nx">Append</span><span class="p">(</span><span class="nx">diags</span><span class="o">...</span><span class="p">)</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">resp</span><span class="p">.</span><span class="nx">Diagnostics</span><span class="p">.</span><span class="nx">HasError</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// If practitioner provided a configuration value for any of the</span>
<span class="w">    </span><span class="c1">// attributes, it must be a known value.</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">config</span><span class="p">.</span><span class="nx">Host</span><span class="p">.</span><span class="nx">IsUnknown</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">resp</span><span class="p">.</span><span class="nx">Diagnostics</span><span class="p">.</span><span class="nx">AddAttributeError</span><span class="p">(</span>
<span class="w">            </span><span class="nx">path</span><span class="p">.</span><span class="nx">Root</span><span class="p">(</span><span class="s">&quot;host&quot;</span><span class="p">),</span>
<span class="w">            </span><span class="s">&quot;Unknown Longship API Host&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;The provider cannot create the Longship API client as there is an unknown configuration value for the Longship API host. &quot;</span><span class="o">+</span>
<span class="w">                </span><span class="s">&quot;Either target apply the source of the value first, set the value statically in the configuration, or use the LONGSHIP_HOST environment variable.&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">config</span><span class="p">.</span><span class="nx">TenantKey</span><span class="p">.</span><span class="nx">IsUnknown</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">resp</span><span class="p">.</span><span class="nx">Diagnostics</span><span class="p">.</span><span class="nx">AddAttributeError</span><span class="p">(</span>
<span class="w">            </span><span class="nx">path</span><span class="p">.</span><span class="nx">Root</span><span class="p">(</span><span class="s">&quot;tenant_key&quot;</span><span class="p">),</span>
<span class="w">            </span><span class="s">&quot;Unknown Longship API TenantKey&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;The provider cannot create the Longship API client as there is an unknown configuration value for the Longship API tenantKey. &quot;</span><span class="o">+</span>
<span class="w">                </span><span class="s">&quot;Either target apply the source of the value first, set the value statically in the configuration, or use the LONGSHIP_TENANT_KEY environment variable.&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">config</span><span class="p">.</span><span class="nx">ApplicationKey</span><span class="p">.</span><span class="nx">IsUnknown</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">resp</span><span class="p">.</span><span class="nx">Diagnostics</span><span class="p">.</span><span class="nx">AddAttributeError</span><span class="p">(</span>
<span class="w">            </span><span class="nx">path</span><span class="p">.</span><span class="nx">Root</span><span class="p">(</span><span class="s">&quot;application_key&quot;</span><span class="p">),</span>
<span class="w">            </span><span class="s">&quot;Unknown Longship API ApplicationKey&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;The provider cannot create the Longship API client as there is an unknown configuration value for the Longship API applicationKey. &quot;</span><span class="o">+</span>
<span class="w">                </span><span class="s">&quot;Either target apply the source of the value first, set the value statically in the configuration, or use the LONGSHIP_APPLICATION_KEY environment variable.&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">resp</span><span class="p">.</span><span class="nx">Diagnostics</span><span class="p">.</span><span class="nx">HasError</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Default values to environment variables, but override</span>
<span class="w">    </span><span class="c1">// with Terraform configuration value if set.</span>

<span class="w">    </span><span class="nx">host</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">Getenv</span><span class="p">(</span><span class="s">&quot;LONGSHIP_HOST&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">tenantKey</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">Getenv</span><span class="p">(</span><span class="s">&quot;LONGSHIP_TENANT_KEY&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">applicationKey</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">Getenv</span><span class="p">(</span><span class="s">&quot;LONGSHIP_APPLICATION_KEY&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">config</span><span class="p">.</span><span class="nx">Host</span><span class="p">.</span><span class="nx">IsNull</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">host</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">config</span><span class="p">.</span><span class="nx">Host</span><span class="p">.</span><span class="nx">ValueString</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">config</span><span class="p">.</span><span class="nx">TenantKey</span><span class="p">.</span><span class="nx">IsNull</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">tenantKey</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">config</span><span class="p">.</span><span class="nx">TenantKey</span><span class="p">.</span><span class="nx">ValueString</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">config</span><span class="p">.</span><span class="nx">ApplicationKey</span><span class="p">.</span><span class="nx">IsNull</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">applicationKey</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">config</span><span class="p">.</span><span class="nx">ApplicationKey</span><span class="p">.</span><span class="nx">ValueString</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// If any of the expected configurations are missing, return</span>
<span class="w">    </span><span class="c1">// errors with provider-specific guidance.</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">host</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">resp</span><span class="p">.</span><span class="nx">Diagnostics</span><span class="p">.</span><span class="nx">AddAttributeError</span><span class="p">(</span>
<span class="w">            </span><span class="nx">path</span><span class="p">.</span><span class="nx">Root</span><span class="p">(</span><span class="s">&quot;host&quot;</span><span class="p">),</span>
<span class="w">            </span><span class="s">&quot;Missing Longship API Host&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;The provider cannot create the Longship API client as there is a missing or empty value for the Longship API host. &quot;</span><span class="o">+</span>
<span class="w">                </span><span class="s">&quot;Set the host value in the configuration or use the LONGSHIP_HOST environment variable. &quot;</span><span class="o">+</span>
<span class="w">                </span><span class="s">&quot;If either is already set, ensure the value is not empty.&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">tenantKey</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">resp</span><span class="p">.</span><span class="nx">Diagnostics</span><span class="p">.</span><span class="nx">AddAttributeError</span><span class="p">(</span>
<span class="w">            </span><span class="nx">path</span><span class="p">.</span><span class="nx">Root</span><span class="p">(</span><span class="s">&quot;tenantKey&quot;</span><span class="p">),</span>
<span class="w">            </span><span class="s">&quot;Missing Longship API Tenant Key&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;The provider cannot create the Longship API client as there is a missing or empty value for the Longship API Tenant Key. &quot;</span><span class="o">+</span>
<span class="w">                </span><span class="s">&quot;Set the tenant_key value in the configuration or use the LONGSHIP_TENANT_KEY environment variable. &quot;</span><span class="o">+</span>
<span class="w">                </span><span class="s">&quot;If either is already set, ensure the value is not empty.&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">applicationKey</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">resp</span><span class="p">.</span><span class="nx">Diagnostics</span><span class="p">.</span><span class="nx">AddAttributeError</span><span class="p">(</span>
<span class="w">            </span><span class="nx">path</span><span class="p">.</span><span class="nx">Root</span><span class="p">(</span><span class="s">&quot;applicationKey&quot;</span><span class="p">),</span>
<span class="w">            </span><span class="s">&quot;Missing Longship API Application Key&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;The provider cannot create the Longship API client as there is a missing or empty value for the Longship API Application Key. &quot;</span><span class="o">+</span>
<span class="w">                </span><span class="s">&quot;Set the application_key value in the configuration or use the LONGSHIP_APPLICATION_KEY environment variable. &quot;</span><span class="o">+</span>
<span class="w">                </span><span class="s">&quot;If either is already set, ensure the value is not empty.&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">resp</span><span class="p">.</span><span class="nx">Diagnostics</span><span class="p">.</span><span class="nx">HasError</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">ctx</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">tflog</span><span class="p">.</span><span class="nx">SetField</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;longship_host&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">host</span><span class="p">)</span>
<span class="w">    </span><span class="nx">ctx</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">tflog</span><span class="p">.</span><span class="nx">SetField</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;longship_tenant_key&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">tenantKey</span><span class="p">)</span>
<span class="w">    </span><span class="nx">ctx</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">tflog</span><span class="p">.</span><span class="nx">SetField</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;longship_application_key&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">applicationKey</span><span class="p">)</span>
<span class="w">    </span><span class="nx">ctx</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">tflog</span><span class="p">.</span><span class="nx">MaskFieldValuesWithFieldKeys</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;longship_tenant_key&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">ctx</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">tflog</span><span class="p">.</span><span class="nx">MaskFieldValuesWithFieldKeys</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;longship_application_key&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="nx">tflog</span><span class="p">.</span><span class="nx">Debug</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Creating Longship client&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// Create a new Longship client using the configuration values</span>
<span class="w">    </span><span class="nx">client</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">NewClient</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">host</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">tenantKey</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">applicationKey</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">resp</span><span class="p">.</span><span class="nx">Diagnostics</span><span class="p">.</span><span class="nx">AddError</span><span class="p">(</span>
<span class="w">            </span><span class="s">&quot;Unable to Create Longship API Client&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;An unexpected error occurred when creating the Longship API client. &quot;</span><span class="o">+</span>
<span class="w">                </span><span class="s">&quot;If the error is not clear, please contact the provider developers.\n\n&quot;</span><span class="o">+</span>
<span class="w">                </span><span class="s">&quot;Longship Client Error: &quot;</span><span class="o">+</span><span class="nx">err</span><span class="p">.</span><span class="nx">Error</span><span class="p">(),</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Make the Longship client available during DataSource and Resource</span>
<span class="w">    </span><span class="c1">// type Configure methods.</span>
<span class="w">    </span><span class="nx">resp</span><span class="p">.</span><span class="nx">DataSourceData</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">client</span>
<span class="w">    </span><span class="nx">resp</span><span class="p">.</span><span class="nx">ResourceData</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">client</span>

<span class="w">    </span><span class="nx">tflog</span><span class="p">.</span><span class="nx">Info</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Configured Longship client&quot;</span><span class="p">,</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">any</span><span class="p">{</span><span class="s">&quot;success&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">})</span>
<span class="p">}</span>

<span class="c1">// DataSources defines the data sources implemented in the provider.</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="o">*</span><span class="nx">longshipProvider</span><span class="p">)</span><span class="w"> </span><span class="nx">DataSources</span><span class="p">(</span><span class="nx">_</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span><span class="w"> </span><span class="p">[]</span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="nx">datasource</span><span class="p">.</span><span class="nx">DataSource</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">[]</span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="nx">datasource</span><span class="p">.</span><span class="nx">DataSource</span><span class="p">{</span>
<span class="w">        </span><span class="nx">NewChargepointsDataSource</span><span class="p">,</span>
<span class="w">        </span><span class="nx">NewWebhooksDataSource</span><span class="p">,</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Resources defines the resources implemented in the provider.</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="o">*</span><span class="nx">longshipProvider</span><span class="p">)</span><span class="w"> </span><span class="nx">Resources</span><span class="p">(</span><span class="nx">_</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span><span class="w"> </span><span class="p">[]</span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="nx">resource</span><span class="p">.</span><span class="nx">Resource</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">[]</span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="nx">resource</span><span class="p">.</span><span class="nx">Resource</span><span class="p">{</span>
<span class="w">        </span><span class="nx">NewWebhookResource</span><span class="p">,</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="https://rotaractamsterdam.nl/">Rotaract Amsterdam</a></li>
                            <li><a href="https://datachef.co">DataChef</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="https://blog.coutinho.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                            <li><a href="https://www.github.com/cbcoutinho">Github</a></li>
                            <li><a href="https://www.linkedin.com/in/cbcoutinho/">LinkedIn</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>